<aside class="notes-panel">
  <div class="notes-panel-header">
    <h2>Notes</h2>
    <% if local_assigns[:notebook] %>
      <div class="notebook-actions">
        <div class="dropdown" data-controller="dropdown">
          <button class="icon-button" type="button" data-action="click->dropdown#toggle">
            <%= render "shared/icon", name: "ellipsis_vertical", size: 16, color: "#667085" %>
          </button>
          <div class="dropdown__menu" data-dropdown-target="menu" data-position="bottom-right">
            <%= link_to "New Note", 
                        new_note_path(notebook_id: notebook.id), 
                        class: "dropdown__menu-item", 
                        data: { turbo_frame: "_top" } %>
            <% if notebook != current_user.default_notebook %>
              <%= button_to "Set as Default", set_default_notebook_path(notebook), 
                  method: :post, 
                  class: "dropdown__menu-item",
                  data: { turbo_method: :post, turbo_stream: true } %>
            <%= button_to "Delete Notebook", notebook_path(notebook), 
                method: :delete, 
                class: "dropdown__menu-item", 
                disabled: notebook == current_user.default_notebook,
                data: { 
                  turbo_confirm: notebook == current_user.default_notebook ? "Cannot delete the default notebook" : "Are you sure you want to delete this notebook? This action cannot be undone.",
                  turbo: false 
                } %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <% if notes.any? %>
    <div class="notes-list">
      <ul>
        <% notes.each do |note| %>
          <li>
            <%= link_to edit_note_path(note, notebook_id: local_assigns[:notebook]&.id),
                        data: { turbo_frame: "_top" },
                        class: "notes-list__link #{note == current ? 'active' : ''}" do %>
              <div class="notes-list__title"><%= note.title.presence || "Untitled" %></div>
              <div class="notes-list__preview">
                <%= sanitize note.content.to_plain_text.truncate(100), tags: [] %>
              </div>
              <div class="notes-list__timestamp">
                <%= time_ago_in_words(note.updated_at) %> ago
              </div>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  <% else %>
    <div class="no-notes">
      <div class="no-notes__icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" color="#667085">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </div>
      <h3 class="no-notes__title">There are no notes here</h3>
      <p class="no-notes__text">Click the <%= link_to new_note_path(notebook_id: local_assigns[:notebook]&.id), 
                  class: "text-link",
                  data: { turbo_frame: "_top" } do %>
             New Note
       
      <% end %> button in the sidebar to create a note.</p>
      
    </div>
  <% end %>
</aside>
